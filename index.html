<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Check and Validate google sheet and table  Doctor</title>
		<style type="text/css">
			*
      {margin: 0;
      padding: 0;
      box-sizing: border-box;}
      .container
      {
        width: 100%;
        height: 100%;
        background: lightgray;
        display:flex;
        align-items: center;
        justify-content: center;
        padding-bottom: 20px;
        padding-top: 20px;
      }
      form
      {
        background: white;
        display: flex;
        flex-direction: column;
        padding: 15px;
        width: 80%;
        max-width: 600px;
        border-radius: 10px;
      }
      form h3
      {
        font-size: 25px;
        margin-bottom: 10px;
      }
      form input,form select,form textarea
      {border: 1px solid black;
      margin-top: 7px;
      margin-bottom: 7px;
      padding: 10px;
      outline: none;
      background: #f5f5f5;
      font-size: 16px;}

      form button
      {
        padding: 15px;
        background-color: green;
        color:white;
        font-size: 16px;
        border: 0;
        outline: none;
        cursor: pointer;
        border-radius: 10px;
        margin-bottom: 10px;
      }

      form button.reset
      {
        background: lightcoral;
      }

      img {
        max-width: 200px;
        max-height: 200px;
      }
	
      table {
      	background: white;
        border-collapse: collapse;
        width: 80%;
        padding-bottom: 10px;
      }
      th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
        text-size-adjust: auto;
      }
	  button
	  {background-color: lightcoral;
        color:white;
        font-size: 16px;
        border: 0;
        outline: none;
        cursor: pointer;
        border-radius: 10px;
	  }
	  form button.reset
			{
				background: lightcoral;
			}
			form button:hover
			{
					background-color: #555;
			}
	  	div button:hover
			{
					background-color: #555;
			}
	    .output-image {
        max-width: 200px;
        max-height: 200px;
        margin-bottom: 10px;
      }
    	#outputTable1 {
        margin-bottom: 20px;
      }

      #outputTable2 {
        margin-bottom: 20px;
      }

      #outputTable3 {
        margin-bottom: 20px;
      }

      #outputImages img {
        max-width: 100%;
        height: auto;
        margin-bottom: 10px;
      }

			.fixed-nav {
						  position: fixed;
						  top: 0;
						  left: 0;
						  right: 0;
						  background-color: lightgrey;
						  text-align: center;
						  
						 }

						.nav-menu {
						  list-style-type: none;
						  margin: 0;
						  padding: 0;
						  display: inline-block;
						}

						.nav-menu li {
						  display: inline-block;
						}

						.nav-menu li a {
						  display: block;
						  padding: 10px 20px;
						  color: white;
						  text-decoration: none;
							}

							.nav-menu li a:hover {
							  background-color: #555;
							}

			a
			{
				background: lightcoral;
				color: white;
				display: inline-flex;
			}
		
		</style>
</head>
<body>
	<div class="container">
		<nav class="fixed-nav">
  		<ul class="nav-menu">
		    <li><a href="#checkinform" > Vehical Check-in </a></li>
		    <li><a href="#genratebil">  Genrate Bill </a></li>
		    <li><a href="#checkbill" > Print and Share Bill </a></li>
		  </ul>
		</nav>
		</div>
	<div class="container" id="checkinform"  style= "flex-direction: column;">
			<form autocomplete="off" method="post" id="personal-form" name = "google-sheet" onsubmit="event.preventDefault();addnamecontact()">
			<h3><center>Vehical Check-in </center></h3>

				<input type="text" id="garagename" name="garagename" placeholder="Enter garage Name" required>
		  	<input type="date" id="datetoday" name="datetoday" placeholder="Select Date" 
		  	required>
		  	<input type="text" id="vehicalnumber" name="vehicalnumber" placeholder="Enter Vehical Number" required>
		  	<input type="text" id="name" name="name" placeholder="type your name" required>
		  	<!--input type="email" id="email" name="email" placeholder="type your email"-->
		  	<input type="text" id="contact" name="mobile" placeholder="type contact number" required>

			  <select name="servicetype" id="servicetype" required>
			  	<option value="no option selected">Select Service Option</option>
			  	<option value="regular">Regular</option>
			  	<option value="repair">Repair</option>
			  	<option value="quickfix">Quick Fix</option>
			  </select>

		  	<textarea rows="4" placeholder="enter your comment" name="message" id="messagee"></textarea>

	 			<div style="display: flex;align-items: center;justify-content: space-between; width:100%;">new:<input type="radio" id="customertype" name="customertype" value="new" >
			  repeat:<input type="radio" id="customertype" name="customertype" value="repeat">
				</div>
				<br>
				<div style="display: flex;align-items: center;justify-content: space-between; width:100%;">
				<button type="reset" class="reset">Reset</button>
		  	<button type="submit" name="submit">Save</button>
		  	</div>
			</form>
			<center>
			<div class="container" >
			<button onclick="shareEnquiryWhatsApp()" style="background: lightcoral;display: block;padding: 10px 20px;color: white;"> Share on Whatsapp </button>
			</div>
		</center>
		</div>
		
		<hr>
	<div class="container" id="genratebil">
		    <form id="item-form" autocomplete="off" method="post" name = "item-form" onsubmit="event.preventDefault(); addBillItem();">
		    	 Date:
		      	<input type="date" id="date-today" name="datetoday" placeholder="Select Date" required>
		    	Garage:
		    		<input type="text" id="garage-name" name="garagename" placeholder="Enter garage Name" required>
		    	Vehical Number:
		    		<input type="text" id="vehical-number" name="vehicalnumbers" placeholder="Enter Vehical Number" required>
	    		Owner Contact:
		    		<input type="text" id="owner-number" name="ownernumbers" placeholder="Enter owner Number" required>
		      Item Name:
		       	<input type="text" id="item-name" name = "itemname" placeholder="enter item name" required>
		      Quantity:
		       	<input type="number" id="item-quantity" name = "itemquantity"placeholder="enter item quantity" required>
		      Price: 
		      	<input type="number" id="item-price" name ="itemprice" placeholder="enter item price"required>
		        <button type="submit" name="submit" >Add Item</button>
		        <button type="reset" class="reset">Reset</button>
			</form>
	</div>
	<hr>
  <div class="container" id= "checkbill">
		<table id="print_final_bill">
          <caption>Bill</caption>
          <thead>
            <tr style="height:40px;">
              <th id="header-date" class="date"></th>
    		  		<th id="header-name" class="name"></th>
    		  		<th id="header-vehical" class="name"></th>
              <th id="header-contact" class="phone"></th>
              <th id="header-garage" class="name"></th>
            </tr>
            <tr>
              <th>Row ID</th>
              <th>Item</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Item Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="bill-items">
            <!-- Dynamic rows will be added here -->
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4" class="total">Total</td>
              <td id="total-amount" class="total">â‚¹0</td>
              <td></td>
            </tr>
          </tfoot>
        </table> 	
	</div>
		 <!-- added new form for final summary capture -->
  <div class="container"  >
	  <form id="total-form">
	  	<input type="date" id="total-date" name="totaldate" value="" readonly style="display: none;">
	   	<input type="text" id="total-garage" name="totalgarage" value="" readonly style="display: none;">
	   	<input type="text" id="total-vname" name="totalvname" value="" readonly style="display: none;">
	   	<input type="number" id="total-input" name="totalinput" value="0" readonly style="display: none;">
	   	<center>
	   	<div  style="display: flex;align-items: center;justify-content: space-between; width:100%;">
      		  <button onclick="printOutputBill()" style="background: lightcoral;">Print Bill</button>
	    			<button type= "submit" name="submit" onclick="sharePDFWhatsApp()" style="background: lightcoral;">Share Bill via WhatsApp </button>
	    			<button onclick="resetForm()" style="background: lightcoral;">Reset Bill</button> 
      </div>
  		</center>
    </form>
	</div>
  
	<script>
			    
			     const scriptURL = 'https://script.google.com/macros/s/AKfycbxk2qXfqYW35EHK646WKgxFQZlNPsqQ47bJ63L8QI0FMZLcANvGc-1XD4cLML4tC3Py/exec'
            const form = document.forms['google-sheet']
          
            form.addEventListener('submit', e => {
              e.preventDefault()
              fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                //.then(response => alert("Enquiry Genrated"))
                .catch(error => console.error('Error!', error.message))
            })

            const scriptURL3 = 'https://script.google.com/macros/s/AKfycbyTLYepu6oQh5DrG2-CQ4Q2MTc-5UCkziHYvdwLY7ZMk6ZxJevyaXVQeuZasOcWBPd3/exec'
            const form3 = document.forms['total-form']
          
            form3.addEventListener('submit', e => {
              e.preventDefault()
              fetch(scriptURL3, { method: 'POST', body: new FormData(form3)})
                //.then(response => alert("Enquiry Genrated"))
                .catch(error => console.error('Error!', error.message))
            })
					
			            const scriptURL2 = 'https://script.google.com/macros/s/AKfycbwo-9NZzVhvq-vidl0Miv-sD9ub1XW6h2OlQOrl0pgiNz_xYZfCb6tdgOha-dhhY7V7/exec'
			            const form2 = document.forms['item-form']
			          	
			          	form2.addEventListener('submit', e => {
			              e.preventDefault()
			              fetch(scriptURL2, { method: 'POST', body: new FormData(form2)})
			                //.then(response => alert("Enquiry Genrated")) 
			                .catch(error => console.error('Error!', error.message))
			               resetItemForm() 
			            })

			            function resetItemForm() 
			            {
										const itemNameInput = document.getElementById('item-name');
										const itemQuantityInput = document.getElementById('item-quantity');
										const itemPriceInput = document.getElementById('item-price');
										itemNameInput.value = '';
										itemQuantityInput.value = '';
										itemPriceInput.value = '';
									}
				
        var rowbillId = 1;
    		var totalAmount = 0;
    		var name;
    		var contact;
				var vehicalnumber;
				var garagename;
				var datetoday;
				var messagee
				var contacto;
				/*var currentDate = new Date();
				var options = { year: 'numeric', month: '2-digit', day: '2-digit' };
				var formattedDate = currentDate.toLocaleDateString(undefined, options);
				*/
					name = document.getElementById('name').value;
    			contact =  document.getElementById('contact').value;
    			vehicalnumber = document.getElementById('vehical-number').value;
	  			garagename = document.getElementById('garage-name').value;
	  			datetoday = document.getElementById('date-today').value;
    			messagee = document.getElementById('messagee').value; // added now 
    			contacto =  document.getElementById('owner-number').value;
    		function addnamecontact() 
			      {
			          // Get input values
			    		name = document.getElementById('name').value;
			    		contact = '91'+ document.getElementById('contact').value;
			    		//vehicalnumber = document.getElementById('vehicalnumber').value;
			    		//garagename = document.getElementById('garagename').value;
			    		//datetoday =  document.getElementById('datetoday').value;
			    		messagee = document.getElementById('messagee').value;
			          // Validate inputs
			          if (name === '' || contact === '' ) {
			            alert('Please fill in all fields');
			            return;
			          }
			          // Update name and contact fields
			        document.getElementById('header-name').textContent = name;
			        document.getElementById('header-contact').textContent = contact;
			    	  document.getElementById('header-vehical').textContent = vehicalnumber;
			    	  document.getElementById('header-garage').textContent = garagename;
			    	  document.getElementById('header-date').textContent = datetoday;
			      }
				
			   
			  function addBillItem() 
    					{
								// Get input values
									var itemName = document.getElementById('item-name').value;
						      var itemQuantity = document.getElementById('item-quantity').value;
								  var itemPrice = document.getElementById('item-price').value;
								  var vname = document.getElementById('vehical-number').value;
    							var billdate = document.getElementById('date-today').value; //added new
    							var garagenameb = document.getElementById('garage-name').value;
  								//var contacto = document.getElementById('owner-number').value;
								      // Validate inputs
								      if (itemName === '' || itemQuantity === '' || itemPrice === '') {
								        alert('Please fill in all fields');
								        return;
								      }

								      // Create a new row for bill
								      var row = document.createElement('tr');
								      var idCell = document.createElement('td');
								      var nameCell = document.createElement('td');
								      var quantityCell = document.createElement('td');
								      var priceCell = document.createElement('td');
								      var totalCell = document.createElement('td');
								      var actionCell = document.createElement('td');
								      var deleteBtn = document.createElement('button');

								      // Set values for new row bill 
								      idCell.textContent = rowbillId;
								      nameCell.textContent = itemName;
								      quantityCell.textContent = itemQuantity;
								      priceCell.textContent = itemPrice;
								      var itemTotal = parseFloat(itemPrice) * parseInt(itemQuantity);
								      totalCell.textContent = 'â‚¹' + itemTotal.toFixed(2);
								      deleteBtn.textContent = 'Delete';
								      deleteBtn.classList.add('delete-btn');
								    	deleteBtn.onclick = function() {
								      deleteBillItem(row);
								    };

								      // Set values for the Total Amount, Vname, and Billdate fields in the form
                                      
                      document.getElementById('total-vname').value = vname;
                      document.getElementById('total-date').value = billdate;
                      document.getElementById('total-garage').value = garagenameb; 
                     	//added new 
                     	vehicalnumber = document.getElementById('vehical-number').value;
			    						garagename = document.getElementById('garage-name').value;
			    						datetoday =  document.getElementById('date-today').value;
		    							contacto = '91'+ document.getElementById('owner-number').value;
			    						document.getElementById('header-vehical').textContent = vehicalnumber;
			    	  				document.getElementById('header-garage').textContent = garagename;
			    	  				document.getElementById('header-date').textContent = datetoday;
			    	  				document.getElementById('header-contact').textContent = contacto;
			    	  				// end new 
								      // Append cells to the row bill
								      row.appendChild(idCell);
								      row.appendChild(nameCell);
								      row.appendChild(quantityCell);
								      row.appendChild(priceCell);
								      row.appendChild(totalCell);
								      row.appendChild(actionCell);
								      actionCell.appendChild(deleteBtn);

								      // Append the row to the bill items table
								      document.getElementById('bill-items').appendChild(row);

								      // Update total amount
								      totalAmount += itemTotal;
								      document.getElementById('total-amount').textContent = 'â‚¹' + totalAmount.toFixed(2);

								      // Reset the form
								      //document.getElementById('item-form').reset();

								      // Increment row ID
								      rowbillId++;
								      document.getElementById('total-input').value = totalAmount.toFixed(2);
    					}

					    // Separate function for deleting a row from the bill
					    function deleteBillItem(row) 
					    {
						      var priceCell = row.querySelector('td:nth-child(4)');
						      var itemPrice = parseFloat(priceCell.textContent);
						      var quantityCell = row.querySelector('td:nth-child(3)');
						      var itemQuantity = parseInt(quantityCell.textContent);
						      var rowTotal = itemPrice * itemQuantity;

						      // Update total amount
						      totalAmount -= rowTotal;
						      document.getElementById('total-amount').textContent = 'â‚¹' + totalAmount.toFixed(2);

						      // Remove the row from the bill items table
						      row.remove();

						      // Reset row ID
						      var rowsb = document.querySelectorAll('#bill-items tr');
						      rowbillId = rowsb.length + 1;
						      for (var i = 0; i < rowsb.length; i++) {
						        rowsb[i].querySelector('td:first-child').textContent = i + 1;
						      }
						      document.getElementById('total-input').value = totalAmount.toFixed(2);
					    }
							
					     // Update name and contact fields
							    document.getElementById('header-name').textContent = name;
							    document.getElementById('header-contact').textContent = contact;
									document.getElementById('header-vehical').textContent = vehicalnumber;
									document.getElementById('header-date').textContent =  datetoday; 
									document.getElementById('header-garage').textContent = garagename; 
									document.getElementById('header-contact').textContent = contacto;
						function printOutputBill() 
							{
				     	var printWindow = window.open('', '_blank');
							var html = '<html><head><title>Print</title>';
							html += '<style>';
							// CSS styles for the print function
							html += 'body { font-family: Arial, sans-serif; }';
							html += 'h1 { text-align: center; }';
							html += 'table { width: 100%; border-collapse: collapse; border: 1px solid #ccc; }';
							html += 'th, td { padding: 5px; border: 1px solid #ccc;text-align:center }';
							html += 'img { max-width: 100%; }';
							html += 'button {display:none}';
							html += '</style>';
							html += '</head><body>';
							html += '<h1>Checkout Bill</h1>';
							html += generateTableHtml('print_final_bill',6,true);
							html += '</body></html>';
							printWindow.document.open();
							printWindow.document.write(html);
							printWindow.document.close();
							printWindow.print();
				    	}
    
   		// Generate HTML for the output table with column restriction and optional column omission
			function generateTableHtml(tableId, columnRestriction, omitDeleteColumn) 
			{
				  var table = document.getElementById(tableId);
				  var clonedTable = table.cloneNode(true);
				  var rows = clonedTable.getElementsByTagName('tr');
				  for (var i = 0; i < rows.length; i++) {
					var cells = rows[i].getElementsByTagName('td');
					if (cells.length > columnRestriction) {
					  for (var j = cells.length - 1; j >= columnRestriction; j--) {
						cells[j].remove();
					  }
					}
					if (omitDeleteColumn && cells.length > 0) {
					  cells[cells.length - 1].remove(); // Remove the last cell (Delete column)
					}
				  }
				  var headers = clonedTable.getElementsByTagName('th');
				  if (omitDeleteColumn && headers.length > 0) {
					headers[headers.length - 1].remove(); // Remove the last header (Delete column header)
				  }
				  return clonedTable.outerHTML;
			}	

				function resetForm() 
				{
					document.getElementById('personal-form').reset();
					document.getElementById('item-form').reset();
					document.getElementById('total-form').reset();
					document.getElementById('bill-items').innerHTML = '';
					document.getElementById('total-amount').textContent = 'â‚¹0';
					document.getElementById('header-name').textContent = '';
					document.getElementById('header-contact').textContent = '';
					document.getElementById('header-vehical').textContent = '';
					document.getElementById('header-date').textContent =  '';
					document.getElementById('header-garage').textContent =  '';
			    rowbillId = 1;
			    totalAmount = 0;
    		}

    			function shareEnquiryWhatsApp()  
    		{
  			var message = "Dear " + name + ", your vehical " + vehicalnumber + "\n\n submitted  for \n" + messagee;
  				message += "."+ garagename +" -Thank you";

					var encodedMessage = encodeURIComponent(message);
					var whatsappURL = "https://api.whatsapp.com/send?phone=" + contact + "&text=" + encodedMessage;
					window.open(whatsappURL);
				} 

    		function sharePDFWhatsApp()  
    		{
  			var message = "Dear " + "Customer" + ", your vehical " + vehicalnumber + " is ready. Here are the bill details:\n\n" + generateTableText('print_final_bill');
  				message += "\n\nBill amount: â‚¹" + totalAmount.toFixed(2) + ". Please collect the bike."+ garagename +" -Thank you";

					var encodedMessage = encodeURIComponent(message);
					var whatsappURL = "https://api.whatsapp.com/send?phone=" + contacto + "&text=" + encodedMessage;
					window.open(whatsappURL);
				} 
// use html table 
  
						 // Generate text for the output table
					function generateTableText(tableId) 
					{
						  var table = document.getElementById(tableId);
						  var text = '';
						  
						  // Get the second row (index 1) as column headers
						  var headerRow = table.querySelector('thead tr:nth-child(2)');
						  var headerCells = headerRow.getElementsByTagName('th');
						  var columnWidths = [];

						  // Calculate the maximum width for each column
						  for (var h = 0; h < headerCells.length - 1; h++) { // Exclude the last header (action column header)
						    var cellWidth = headerCells[h].textContent.trim().length;
						    columnWidths.push(cellWidth);
						  }

						  // Get the table data rows
						  var rows = table.getElementsByTagName('tr');
						  for (var i = 0; i < rows.length; i++) 
						  {
						    var cells = rows[i].getElementsByTagName('td');
						      for (var j = 0; j < cells.length - 1; j++) 
						      { // Exclude the last column (action column)
						        var cellWidth = cells[j].textContent.trim().length;
						        if (cellWidth > columnWidths[j]) 
						         {
						                columnWidths[j] = cellWidth;
						         }
						      }
						  }

						  // Generate the text with equal spacing
						  for (var h = 0; h < headerCells.length - 1; h++) {
						    text += '|' + padString(headerCells[h].textContent.trim(), columnWidths[h]) + ' ';
						  }
						  text += '|\n';

						  // Add table border for the column headers
						  for (var h = 0; h < headerCells.length - 1; h++) {
						    text += '+' + repeatChar('-', columnWidths[h]) + '-';
						  }
						  text += '+\n';

						  // Get the table data rows
						  for (var i = 0; i < rows.length; i++) {
						    var cells = rows[i].getElementsByTagName('td');
						    for (var j = 0; j < cells.length - 1; j++) { // Exclude the last column (action column)
						      text += '|' + padString(cells[j].textContent.trim(), columnWidths[j]) + ' ';
						    }
						    text += '|\n';
						  }

						  // Add table border for the data rows
						  for (var h = 0; h < headerCells.length - 1; h++) {
						    text += '+' + repeatChar('-', columnWidths[h]) + '-';
						  }
						  text += '+\n';

						  return text;
						}

						function padString(str, length) {
						  var paddedString = str;
						  while (paddedString.length < length) {
						    paddedString += ' ';
						  }
						  return paddedString;
						}

						function repeatChar(char, times) {
						  var repeatedString = '';
						  for (var i = 0; i < times; i++) {
						    repeatedString += char;
						  }
						  return repeatedString;
						}		
</script>
</body>
</html>
